Ignoring: branches, cache, langauge, sudo
START gemfile: gemfiles/4.1.16.gemfile rvm: 2.2.6
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | ❌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 💀      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   562.153M memsize (   248.000  retained)
                        11.400M objects (     4.000  retained)
                        50.000  strings (     0.000  retained)
             msgpack   274.930M memsize (   232.000  retained)
                         4.780M objects (     1.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   368.910M memsize (     0.000  retained)
                         5.750M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    85.520M memsize (     0.000  retained)
                         1.490M objects (     0.000  retained)
                        25.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   85520000 allocated
             msgpack:  274930232 allocated - 3.21x more
             Oj.dump:  368910000 allocated - 4.31x more
       Rails to_json:  562152520 allocated - 6.57x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   259.000  i/100ms
             msgpack   550.000  i/100ms
             Oj.dump   513.000  i/100ms
    Oj::Rails.encode     1.745k i/100ms
Calculating -------------------------------------
       Rails to_json      2.755k (± 3.9%) i/s -     13.986k in   5.084270s
             msgpack      6.582k (± 6.2%) i/s -     33.000k in   5.034478s
             Oj.dump      5.895k (± 3.4%) i/s -     29.754k in   5.053206s
    Oj::Rails.encode     17.749k (± 4.6%) i/s -     88.995k in   5.025052s

Comparison:
    Oj::Rails.encode:    17749.0 i/s
             msgpack:     6582.1 i/s - 2.70x  slower
             Oj.dump:     5895.4 i/s - 3.01x  slower
       Rails to_json:     2755.3 i/s - 6.44x  slower


SUCCESS gemfile: gemfiles/4.1.16.gemfile rvm: 2.2.6
START gemfile: gemfiles/4.1.16.gemfile rvm: 2.3.3
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | ❌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 💀      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   558.953M memsize (   248.000  retained)
                        11.320M objects (     4.000  retained)
                        50.000  strings (     0.000  retained)
             msgpack   269.341M memsize (    10.952k retained)
                         4.640M objects (    21.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   363.710M memsize (     0.000  retained)
                         5.620M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    86.720M memsize (     0.000  retained)
                         1.520M objects (     0.000  retained)
                        27.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   86720000 allocated
             msgpack:  269340952 allocated - 3.11x more
             Oj.dump:  363710000 allocated - 4.19x more
       Rails to_json:  558952520 allocated - 6.45x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   276.000  i/100ms
             msgpack   660.000  i/100ms
             Oj.dump   456.000  i/100ms
    Oj::Rails.encode     1.644k i/100ms
Calculating -------------------------------------
       Rails to_json      2.646k (± 5.3%) i/s -     13.248k in   5.020660s
             msgpack      6.562k (± 8.2%) i/s -     33.000k in   5.059452s
             Oj.dump      5.642k (± 9.6%) i/s -     28.272k in   5.055156s
    Oj::Rails.encode     17.242k (± 6.2%) i/s -     87.132k in   5.073235s

Comparison:
    Oj::Rails.encode:    17241.8 i/s
             msgpack:     6562.5 i/s - 2.63x  slower
             Oj.dump:     5641.6 i/s - 3.06x  slower
       Rails to_json:     2646.0 i/s - 6.52x  slower


SUCCESS gemfile: gemfiles/4.1.16.gemfile rvm: 2.3.3
START gemfile: gemfiles/4.1.16.gemfile rvm: 2.4.0
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb
/ruby-json-benchmark/vendor/bundle/ruby/2.4.0/gems/activesupport-4.1.16/lib/active_support/core_ext/numeric/time.rb:50:in `*': ActiveSupport::Duration can't be coerced into Integer (TypeError)
	from /ruby-json-benchmark/vendor/bundle/ruby/2.4.0/gems/activesupport-4.1.16/lib/active_support/core_ext/numeric/time.rb:50:in `days'
	from /ruby-json-benchmark/vendor/bundle/ruby/2.4.0/gems/activesupport-4.1.16/lib/active_support/core_ext/integer/time.rb:36:in `months'
	from /ruby-json-benchmark/lib/test_data_rails.rb:30:in `<top (required)>'
	from compatibility_test.rb:10:in `require'
	from compatibility_test.rb:10:in `<main>'
FAILURE gemfile: gemfiles/4.1.16.gemfile rvm: 2.4.0
START gemfile: gemfiles/4.2.8.gemfile  rvm: 2.2.6
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | ❌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 💀      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   562.153M memsize (   344.000  retained)
                        11.400M objects (     5.000  retained)
                        50.000  strings (     0.000  retained)
             msgpack   274.930M memsize (   232.000  retained)
                         4.780M objects (     1.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   368.910M memsize (     0.000  retained)
                         5.750M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    85.520M memsize (     0.000  retained)
                         1.490M objects (     0.000  retained)
                        25.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   85520000 allocated
             msgpack:  274930232 allocated - 3.21x more
             Oj.dump:  368910000 allocated - 4.31x more
       Rails to_json:  562152520 allocated - 6.57x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   252.000  i/100ms
             msgpack   625.000  i/100ms
             Oj.dump   568.000  i/100ms
    Oj::Rails.encode     1.781k i/100ms
Calculating -------------------------------------
       Rails to_json      2.716k (± 5.3%) i/s -     13.608k in   5.024179s
             msgpack      6.769k (± 4.4%) i/s -     34.375k in   5.088727s
             Oj.dump      6.000k (± 4.8%) i/s -     30.104k in   5.029655s
    Oj::Rails.encode     18.143k (± 4.1%) i/s -     90.831k in   5.014967s

Comparison:
    Oj::Rails.encode:    18143.1 i/s
             msgpack:     6768.8 i/s - 2.68x  slower
             Oj.dump:     5999.9 i/s - 3.02x  slower
       Rails to_json:     2716.0 i/s - 6.68x  slower


SUCCESS gemfile: gemfiles/4.2.8.gemfile  rvm: 2.2.6
START gemfile: gemfiles/4.2.8.gemfile  rvm: 2.3.3
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | ❌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 💀      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   558.953M memsize (   344.000  retained)
                        11.320M objects (     5.000  retained)
                        50.000  strings (     0.000  retained)
             msgpack   269.341M memsize (    10.952k retained)
                         4.640M objects (    21.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   363.710M memsize (     0.000  retained)
                         5.620M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    86.720M memsize (     0.000  retained)
                         1.520M objects (     0.000  retained)
                        27.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   86720000 allocated
             msgpack:  269340952 allocated - 3.11x more
             Oj.dump:  363710000 allocated - 4.19x more
       Rails to_json:  558952520 allocated - 6.45x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   147.000  i/100ms
             msgpack   439.000  i/100ms
             Oj.dump   447.000  i/100ms
    Oj::Rails.encode     1.706k i/100ms
Calculating -------------------------------------
       Rails to_json      2.704k (±11.1%) i/s -     13.377k in   5.009333s
             msgpack      6.756k (±16.6%) i/s -     32.925k in   5.011767s
             Oj.dump      5.743k (±12.7%) i/s -     28.608k in   5.058290s
    Oj::Rails.encode     16.636k (±15.2%) i/s -     81.888k in   5.075079s

Comparison:
    Oj::Rails.encode:    16635.9 i/s
             msgpack:     6755.8 i/s - 2.46x  slower
             Oj.dump:     5743.1 i/s - 2.90x  slower
       Rails to_json:     2704.3 i/s - 6.15x  slower


SUCCESS gemfile: gemfiles/4.2.8.gemfile  rvm: 2.3.3
START gemfile: gemfiles/4.2.8.gemfile  rvm: 2.4.0
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | ❌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 💀      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   544.812M memsize (   536.000  retained)
                        11.220M objects (     6.000  retained)
                        50.000  strings (     0.000  retained)
             msgpack   251.049M memsize (     9.312k retained)
                         4.540M objects (    21.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   336.940M memsize (     0.000  retained)
                         5.520M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    79.680M memsize (   192.000  retained)
                         1.410M objects (     1.000  retained)
                        23.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   79680192 allocated
             msgpack:  251049312 allocated - 3.15x more
             Oj.dump:  336940000 allocated - 4.23x more
       Rails to_json:  544812272 allocated - 6.84x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   305.000  i/100ms
             msgpack   758.000  i/100ms
             Oj.dump   640.000  i/100ms
    Oj::Rails.encode     2.008k i/100ms
Calculating -------------------------------------
       Rails to_json      2.972k (± 4.8%) i/s -     14.945k in   5.039133s
             msgpack      7.357k (± 9.0%) i/s -     37.142k in   5.092328s
             Oj.dump      6.427k (± 8.4%) i/s -     32.000k in   5.019711s
    Oj::Rails.encode     20.084k (± 4.4%) i/s -    100.400k in   5.008269s

Comparison:
    Oj::Rails.encode:    20083.7 i/s
             msgpack:     7356.5 i/s - 2.73x  slower
             Oj.dump:     6427.0 i/s - 3.12x  slower
       Rails to_json:     2972.5 i/s - 6.76x  slower


SUCCESS gemfile: gemfiles/4.2.8.gemfile  rvm: 2.4.0
START gemfile: gemfiles/5.0.2.gemfile  rvm: 2.2.6
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 👌      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   557.443M memsize (   464.000  retained)
                        11.280M objects (     7.000  retained)
                        50.000  strings (     1.000  retained)
             msgpack   269.030M memsize (   232.000  retained)
                         4.630M objects (     1.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   363.400M memsize (     0.000  retained)
                         5.610M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    83.610M memsize (     0.000  retained)
                         1.440M objects (     0.000  retained)
                        26.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   83610000 allocated
             msgpack:  269030232 allocated - 3.22x more
             Oj.dump:  363400000 allocated - 4.35x more
       Rails to_json:  557442848 allocated - 6.67x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   265.000  i/100ms
             msgpack   615.000  i/100ms
             Oj.dump   558.000  i/100ms
    Oj::Rails.encode     1.706k i/100ms
Calculating -------------------------------------
       Rails to_json      2.694k (± 4.4%) i/s -     13.515k in   5.026013s
             msgpack      6.855k (± 6.3%) i/s -     34.440k in   5.044588s
             Oj.dump      6.064k (± 4.8%) i/s -     30.690k in   5.072408s
    Oj::Rails.encode     17.715k (± 4.0%) i/s -     88.712k in   5.015543s

Comparison:
    Oj::Rails.encode:    17715.0 i/s
             msgpack:     6854.7 i/s - 2.58x  slower
             Oj.dump:     6064.2 i/s - 2.92x  slower
       Rails to_json:     2694.2 i/s - 6.58x  slower


SUCCESS gemfile: gemfiles/5.0.2.gemfile  rvm: 2.2.6
START gemfile: gemfiles/5.0.2.gemfile  rvm: 2.3.3
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 👌      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   554.243M memsize (   464.000  retained)
                        11.200M objects (     7.000  retained)
                        50.000  strings (     1.000  retained)
             msgpack   263.441M memsize (    10.952k retained)
                         4.490M objects (    21.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   358.200M memsize (     0.000  retained)
                         5.480M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    84.810M memsize (     0.000  retained)
                         1.470M objects (     0.000  retained)
                        28.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   84810000 allocated
             msgpack:  263440952 allocated - 3.11x more
             Oj.dump:  358200000 allocated - 4.22x more
       Rails to_json:  554242848 allocated - 6.54x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   174.000  i/100ms
             msgpack   499.000  i/100ms
             Oj.dump   335.000  i/100ms
    Oj::Rails.encode     1.737k i/100ms
Calculating -------------------------------------
       Rails to_json      2.619k (±11.3%) i/s -     13.050k in   5.050032s
             msgpack      7.210k (±19.6%) i/s -     34.930k in   5.040792s
             Oj.dump      5.973k (±17.3%) i/s -     29.145k in   5.032593s
    Oj::Rails.encode     18.352k (± 7.5%) i/s -     92.061k in   5.044822s

Comparison:
    Oj::Rails.encode:    18352.3 i/s
             msgpack:     7210.2 i/s - 2.55x  slower
             Oj.dump:     5973.0 i/s - 3.07x  slower
       Rails to_json:     2618.7 i/s - 7.01x  slower


SUCCESS gemfile: gemfiles/5.0.2.gemfile  rvm: 2.3.3
START gemfile: gemfiles/5.0.2.gemfile  rvm: 2.4.0
bundle install --deployment --path /ruby-json-benchmark/vendor/bundle --quiet
bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb

Comparing Rails to_json with other JSON implementations
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| class                           | JSON to_json | Oj.dump | Oj::Rails.encode | Oj to_json | msgpack "rails" |
+---------------------------------+--------------+---------+------------------+------------+-----------------+
| Regexp                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| FalseClass                      | 👌           | 👌      | 👌               | 👌         | 👌              |
| NilClass                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Object                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| TrueClass                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| String                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringChinese                   | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial                   | ❌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial2                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| StringSpecial3                  | 👌           | 👌      | 👌               | 👌         | 👌              |
| Numeric                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Symbol                          | 👌           | 👌      | 👌               | 👌         | 👌              |
| Time                            | ❌           | 👌      | 👌               | 👌         | 👌              |
| Array                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Hash                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| HashNotEmpty                    | 👌           | 👌      | 👌               | 👌         | 👌              |
| Date                            | 👌           | 👌      | 👌               | 👌         | 👌              |
| DateTime                        | ❌           | 👌      | 👌               | 👌         | 👌              |
| Enumerable                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimal                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| BigDecimalInfinity              | ❌           | 👌      | 👌               | 👌         | 👌              |
| Struct                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| Float                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| FloatInfinity                   | 💀           | 👌      | 👌               | 👌         | ❌              |
| Range                           | 👌           | 👌      | 👌               | 👌         | 👌              |
| Complex                         | 👌           | 👌      | 👌               | 👌         | 👌              |
| Exception                       | 👌           | 👌      | 👌               | 👌         | 👌              |
| OpenStruct                      | ❌           | 👌      | 👌               | 👌         | 👌              |
| Rational                        | 👌           | 👌      | 👌               | 👌         | 👌              |
| Process::Status                 | ❌           | 👌      | 👌               | 👌         | 👌              |
| AsJson                          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ToJson                          | 👌           | ❌      | ❌               | 👌         | ❌              |
| ActiveSupport::TimeWithZone     | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveModel::Errors             | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Duration         | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveSupport::Multibyte::Chars | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord::Relation          | ❌           | 👌      | 👌               | 👌         | 👌              |
| ActiveRecord                    | ❌           | 👌      | 👌               | 👌         | 👌              |
+---------------------------------+--------------+---------+------------------+------------+-----------------+

Calculating -------------------------------------
       Rails to_json   540.903M memsize (   656.000  retained)
                        11.120M objects (     8.000  retained)
                        50.000  strings (     1.000  retained)
             msgpack   245.949M memsize (     9.312k retained)
                         4.410M objects (    21.000  retained)
                        50.000  strings (     0.000  retained)
             Oj.dump   332.230M memsize (     0.000  retained)
                         5.400M objects (     0.000  retained)
                        50.000  strings (     0.000  retained)
    Oj::Rails.encode    77.770M memsize (   192.000  retained)
                         1.360M objects (     1.000  retained)
                        24.000  strings (     0.000  retained)

Comparison:
    Oj::Rails.encode:   77770192 allocated
             msgpack:  245949312 allocated - 3.16x more
             Oj.dump:  332230000 allocated - 4.27x more
       Rails to_json:  540902520 allocated - 6.96x more
---------------------------------------------

Warming up --------------------------------------
       Rails to_json   265.000  i/100ms
             msgpack   676.000  i/100ms
             Oj.dump   538.000  i/100ms
    Oj::Rails.encode     1.680k i/100ms
Calculating -------------------------------------
       Rails to_json      2.251k (±17.5%) i/s -     11.130k in   5.145463s
             msgpack      6.051k (±12.0%) i/s -     29.744k in   5.005225s
             Oj.dump      5.385k (± 9.2%) i/s -     26.900k in   5.043975s
    Oj::Rails.encode     17.472k (±13.1%) i/s -     85.680k in   5.030475s

Comparison:
    Oj::Rails.encode:    17472.0 i/s
             msgpack:     6050.6 i/s - 2.89x  slower
             Oj.dump:     5384.6 i/s - 3.24x  slower
       Rails to_json:     2251.0 i/s - 7.76x  slower


SUCCESS gemfile: gemfiles/5.0.2.gemfile  rvm: 2.4.0
rm -rf .bundle

Results:
SUCCESS gemfile: gemfiles/4.1.16.gemfile rvm: 2.2.6
SUCCESS gemfile: gemfiles/4.1.16.gemfile rvm: 2.3.3
FAILURE gemfile: gemfiles/4.1.16.gemfile rvm: 2.4.0
SUCCESS gemfile: gemfiles/4.2.8.gemfile  rvm: 2.2.6
SUCCESS gemfile: gemfiles/4.2.8.gemfile  rvm: 2.3.3
SUCCESS gemfile: gemfiles/4.2.8.gemfile  rvm: 2.4.0
SUCCESS gemfile: gemfiles/5.0.2.gemfile  rvm: 2.2.6
SUCCESS gemfile: gemfiles/5.0.2.gemfile  rvm: 2.3.3
SUCCESS gemfile: gemfiles/5.0.2.gemfile  rvm: 2.4.0

Failed:
BUNDLE_GEMFILE=gemfiles/4.1.16.gemfile RBENV_VERSION=2.4.0 bundle exec ruby compatibility_test.rb && bundle exec ruby benchmark.rb
